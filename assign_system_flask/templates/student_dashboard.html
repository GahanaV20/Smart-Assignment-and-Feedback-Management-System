{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}

{% block content %}


<style>
/* ===== Card Styling ===== */
.dashboard-card{
    border-radius:12px;
    padding:18px;
    background:white;
    border-left:6px solid #2e89ff;
    transition:0.25s;
}
.dashboard-card:hover{
    transform:translateY(-5px);
    box-shadow:0 6px 14px rgba(0,0,0,0.12);
}

/* Section Headings */
.section-title{
    font-weight:700;
    margin-top:25px;
    margin-bottom:10px;
}

/* Badges */
.badge-type{
    font-size:11px;
    background:#dbe9ff;
    color:#0055cc;
    border-radius:6px;
    padding:3px 8px;
}

/* Status Badges */
.submitted-badge{
    background:#6c757d;
    color:white;
    padding:4px 10px;
    border-radius:6px;
    font-size:12px;
}
.missed-badge{
    background:#ff4f4f;
    color:white;
    padding:4px 10px;
    border-radius:6px;
    font-size:12px;
}
.available-badge{
    background:#1dbf73;
    color:white;
    padding:4px 10px;
    border-radius:6px;
    font-size:12px;
}
</style>



<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold">Student Dashboard</h2>
        <p class="text-muted small">Your assignments categorized below</p>
    </div>

    <a href="{{ url_for('student_feedback') }}" class="btn btn-primary btn-sm px-3">
        View Marks & Feedback
    </a>
</div>



<!-- ================= 1. AVAILABLE ================= -->
<h4 class="section-title text-success">Available to Submit</h4>
{% for a in assignments %}
{% if a.deadline > now and a.assignment_id not in submitted %}
<div class="dashboard-card mb-3">
    <h5 class="fw-bold">{{ a.title }}</h5>
    <small class="text-muted">By: {{ a.teacher_name }}</small><br>
    <span class="badge-type">{{ a.assignment_type|upper }}</span>
    <p class="text-muted mt-2">{{ a.description }}</p>
    <small class="text-muted"><b>Deadline:</b> {{ a.deadline }}</small>

    <div class="mt-3">

        {# If teacher uploaded reference file #}
        {% if a.attachment %}
        <a href="{{ url_for('static', filename=a.attachment) }}" 
           target="_blank" class="btn btn-primary btn-sm me-2">
           ðŸ“„ View Attached File
        </a>
        {% endif %}

        {% if a.assignment_type == "quiz" %}
            <a href="/student/quiz/{{ a.assignment_id }}" class="btn btn-warning btn-sm">
                Attempt Quiz
            </a>

        {% else %}
        <!-- Upload for WRITTEN + FILE -->
        <form method="POST" action="{{ url_for('upload_submission') }}" 
              enctype="multipart/form-data" class="d-flex mt-2">
            <input type="hidden" name="assignment_id" value="{{ a.assignment_id }}">
            <input type="file" name="file" class="form-control form-control-sm w-50" required>
            <button class="btn btn-success btn-sm ms-2">Submit</button>
        </form>
        {% endif %}
    </div>
</div>
{% endif %}
{% endfor %}



<!-- =====================================================
        2. MISSED / DEADLINE OVER
=====================================================-->
<h4 class="section-title text-danger">Missed / Deadline Over</h4>
{% set miss = 0 %}
{% for a in assignments %}
    {% if a.deadline < now and a.assignment_id not in submitted %}
        {% set miss = 1 %}
        <div class="dashboard-card mb-3 border-danger border-start-0" style="border-left:6px solid #ff4f4f">

            <h5 class="fw-bold">{{ a.title }}</h5>
            <span class="missed-badge">Deadline Missed</span><br>
            <small class="text-muted"><b>Deadline:</b> {{ a.deadline }}</small>

        </div>
    {% endif %}
{% endfor %}




<!-- =====================================================
        3. SUBMITTED ASSIGNMENTS
=====================================================-->
<h4 class="section-title text-secondary">Submitted Assignments</h4>
{% set sub = 0 %}
{% for a in assignments %}
    {% if a.assignment_id in submitted %}
        {% set sub = 1 %}
        <div class="dashboard-card mb-3 border-secondary border-start-0" style="border-left:6px solid #6c757d">

            <h5 class="fw-bold">{{ a.title }}</h5>
            <span class="submitted-badge">Submitted</span><br>
            <small class="text-muted"><b>Deadline:</b> {{ a.deadline }}</small>

        </div>
    {% endif %}
{% endfor %}




{% endblock %}
